- name: YUM install lldp package
  yum: name=lldpad state=present

- name: LLDP enable as a serice
  service:
    name: lldpad
    state: started
    enabled: yes 

#
# The use of file provides more control to the admin as it
# can be made manually or simply generated by command:
#
# shell: "ls /sys/class/net/ | grep 'eth\\|em\\|p[0-9]p'"
#
- name: LLDP get the list of interfaces from file
  command: cat "{{ dice_lldp_dev_file }}"
  register: dev_list
  changed_when: false

- name: LLDP apply lldp config on each given interface
  script: config_nic_lldp.sh {{ item }}
  register: script_result
  changed_when: "script_result.rc == 0"
  failed_when: "script_result.rc == -1"
  with_items:
    - "{{ dev_list.stdout_lines }}"
